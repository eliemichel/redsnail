<!DOCTYPE html>
<head>
<meta charset="UTF-8">
<title>Redsnail</title>
<link rel="stylesheet" href="{{static('phosphor.min.css')}}">
<link rel="stylesheet" href="{{static('font-awesome/css/font-awesome.min.css')}}">
<link rel="stylesheet" href="{{static('styles.css')}}">
<script type="text/javascript" src="{{static('jquery.min.js')}}"></script>
<script type="text/javascript" src="{{static('phosphor.min.js')}}"></script>
<script>
window.onload = function() {
    var protocol = (window.location.protocol.indexOf("https") === 0) ? "wss" : "ws";
    var ws_url = protocol+"://"+window.location.host+ "{{ws_url_path}}";

    var ws = new WebSocket(ws_url);

    var panel_widget = new phosphor.Widget();

    ws.onmessage = function(event) {
        var msg = JSON.parse(event.data);
        var panel = $(panel_widget.domNode());
        panel.empty();
        var dir, file, tile;
        for (var i=0; i < msg.data.dirs.length; i++) {
            dir = msg.data.dirs[i];
            tile = $('<div/>').addClass('minitile')
                .append($('<i/>').addClass('fa fa-folder-open'))
                .append($('<span/>').addClass('tiletext').text(dir));
            panel.append(tile);
        }
        for (var i=0; i < msg.data.files.length; i++) {
            file = msg.data.files[i];
            tile = $('<div/>').addClass('minitile')
                .append($('<i/>').addClass('fa fa-file-o'))
                .append($('<span/>').addClass('tiletext').text(file));
            panel.append(tile);
        }
    };
    
  function tabBarFactory() {
    var tabBar = new phosphor.TabBar();
    tabBar.setTabOverlap(-1);
    tabBar.setTabWidth(130);
    return tabBar;
  }

  var area = new phosphor.DockArea(tabBarFactory);

  area.insertWidget('Files', panel_widget, phosphor.DockMode.TabBefore);

  area.mount(document.body);

  window.onresize = function() {
    area.resize();
  };
};
</script>
</head>
<body>
</body>
